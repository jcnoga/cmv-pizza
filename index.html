<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pizzaria Cost Control Pro - Gest√£o Completa</title>

    <!--
    ====================================================================================================
    INSTRU√á√ïES DE CONFIGURA√á√ÉO E PUBLICA√á√ÉO
    ====================================================================================================
    1.  COLE SUA CONFIGURA√á√ÉO `firebaseConfig` NA SE√á√ÉO <script> ABAIXO.
    2.  ATIVE "E-mail/senha" NA ABA "AUTHENTICATION" DO FIREBASE.
    3.  ATIVE O "STORAGE" NO SEU PROJETO FIREBASE.
    4.  CRIE O "FIRESTORE DATABASE" EM MODO DE PRODU√á√ÉO.
    5.  CRIE OS √çNDICES COMPOSTOS (userId ASC, nome ASC) PARA 'fornecedores', 'insumos', 'receitas'.
    6.  CRIE O √çNDICE COMPOSTO (userId ASC, mes DESC) PARA A NOVA COLE√á√ÉO 'custosMensais'.
    ====================================================================================================
    -->

    <style>
        :root {
            --primary-color: #D32F2F; --primary-dark: #B71C1C; --secondary-color: #FFC107;
            --light-gray: #f4f4f4; --medium-gray: #ccc; --dark-gray: #555;
            --text-color: #333; --white: #fff; --success-color: #4CAF50;
            --error-color: #f44336; --info-color: #2196F3; --shadow: 0 2px 8px rgba(0,0,0,0.1);
            --border-radius: 8px;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--light-gray); color: var(--text-color); line-height: 1.6; display: flex; flex-direction: column; min-height: 100vh; }
        header { background-color: var(--primary-color); color: var(--white); padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; box-shadow: var(--shadow); flex-wrap: wrap; }
        header h1 { font-size: 1.5rem; margin-right: 2rem; display: flex; align-items: center;}
        #header-logo { height: 35px; width: 35px; object-fit: cover; margin-right: 15px; border-radius: 5px; }
        #header-logo-default { font-size: 1.8rem; margin-right: 15px; }
        #auth-container, #app-container { width: 100%; max-width: 1200px; margin: 2rem auto; padding: 0 1rem; }
        .auth-form { background: var(--white); padding: 2.5rem; border-radius: var(--border-radius); box-shadow: var(--shadow); max-width: 450px; margin: 2rem auto; }
        .auth-form h2 { text-align: center; margin-bottom: 1.5rem; color: var(--primary-dark); }
        .form-group { margin-bottom: 1.25rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 0.75rem; border: 1px solid var(--medium-gray); border-radius: var(--border-radius); font-size: 1rem; }
        .form-group input[type="file"] { padding: 0.5rem; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 2px rgba(211, 47, 47, 0.2); }
        .btn { display: inline-block; padding: 0.8rem 1.5rem; font-size: 1rem; font-weight: 600; text-align: center; border: none; border-radius: var(--border-radius); cursor: pointer; transition: background-color 0.3s, transform 0.1s; width: 100%; }
        .btn:disabled { background-color: var(--medium-gray); cursor: not-allowed; }
        .btn:active:not(:disabled) { transform: scale(0.98); }
        .btn-primary { background-color: var(--primary-color); color: var(--white); } .btn-primary:hover:not(:disabled) { background-color: var(--primary-dark); }
        .btn-secondary { background-color: var(--dark-gray); color: var(--white); } .btn-secondary:hover { background-color: #333; }
        .btn-success { background-color: var(--success-color); color: var(--white); }
        .btn-danger { background-color: var(--error-color); color: var(--white); }
        .btn-info { background-color: var(--info-color); color: var(--white); }
        .btn-small { padding: 0.4rem 0.8rem; font-size: 0.85rem; width: auto; }
        .auth-link { text-align: center; margin-top: 1rem; } .auth-link a { color: var(--primary-color); text-decoration: none; font-weight: 600; }
        nav { display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap; }
        nav a, nav button { color: var(--white); text-decoration: none; background: none; border: none; cursor: pointer; font-size: 0.95rem; padding: 0.5rem 1rem; border-radius: var(--border-radius); transition: background-color 0.2s; }
        nav a:hover, nav button:hover, nav a.active { background-color: rgba(255,255,255,0.2); }
        #logout-button { background-color: var(--secondary-color); color: var(--text-color); font-weight: bold; }
        main { flex: 1; }
        .view { display: none; } .view.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .card { background: var(--white); padding: 1.5rem; border-radius: var(--border-radius); box-shadow: var(--shadow); margin-bottom: 1.5rem; }
        .grid-container { display: grid; gap: 1.5rem; }
        @media (min-width: 768px) { .grid-2 { grid-template-columns: repeat(2, 1fr); } .grid-3 { grid-template-columns: repeat(3, 1fr); } .grid-4 { grid-template-columns: repeat(4, 1fr); } }
        .kpi-card { text-align: center; }
        .kpi-card h3 { color: var(--dark-gray); font-size: 1rem; margin-bottom: 0.5rem; }
        .kpi-card .value { font-size: 2rem; font-weight: 700; color: var(--primary-dark); }
        h2 { margin-bottom: 1rem; color: var(--primary-dark); border-bottom: 2px solid var(--light-gray); padding-bottom: 0.5rem; }
        table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        th, td { padding: 0.75rem; text-align: left; border-bottom: 1px solid var(--medium-gray); }
        th { background-color: var(--light-gray); font-weight: 600; }
        tr:hover { background-color: #f9f9f9; }
        .actions-cell { text-align: right; white-space: nowrap; }
        .actions-cell .btn { margin-left: 0.5rem; }
        .form-row { display: flex; gap: 1rem; flex-wrap: wrap; }
        .form-row .form-group { flex: 1; min-width: 150px; }
        #ingredients-list .ingredient-row { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; padding-bottom: 0.5rem; border-bottom: 1px dashed var(--medium-gray); }
        #ingredients-list .ingredient-row > * { flex: 1; }
        #ingredients-list .ingredient-row .costo-ingrediente { flex: 0 0 120px; font-weight: bold; text-align: right; }
        .total-cost { text-align: right; font-size: 1.5rem; font-weight: bold; margin-top: 1rem; color: var(--primary-dark); }
        .simulator-result { margin-top: 1rem; padding: 1rem; background-color: #e8f5e9; border-left: 5px solid var(--success-color); border-radius: var(--border-radius); }
        .simulator-result p { font-size: 1.2rem; margin-bottom: 0.5rem; } .simulator-result strong { color: var(--primary-dark); }
        .alert-item { padding: 0.75rem; border-radius: var(--border-radius); margin-bottom: 0.5rem; background-color: #fff3e0; border: 1px solid #ffe0b2; color: #e65100; }
        .cmv-ok { color: var(--success-color); } .cmv-warn { color: #f57c00; } .cmv-danger { color: var(--error-color); }
        .cmv-visualizer { width: 100%; background-color: var(--medium-gray); border-radius: var(--border-radius); height: 25px; overflow: hidden; margin-top: 0.5rem; }
        .cmv-visualizer-bar { height: 100%; transition: width 0.5s; }
        .cmv-visualizer-bar.ok { background-color: var(--success-color); } .cmv-visualizer-bar.warn { background-color: var(--secondary-color); } .cmv-visualizer-bar.danger { background-color: var(--error-color); }
        .filter-container { margin-bottom: 1rem; display: flex; gap: 1rem; align-items: center; flex-wrap: wrap; }
        .filter-container input { padding: 0.5rem; border-radius: var(--border-radius); border: 1px solid var(--medium-gray); width: 100%; max-width: 400px; }
        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); padding: 1rem 2rem; border-radius: var(--border-radius); color: var(--white); z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.5s, visibility 0.5s; }
        .toast.show { opacity: 1; visibility: visible; }
        .toast.success { background-color: var(--success-color); } .toast.error { background-color: var(--error-color); }
        footer { text-align: center; padding: 1.5rem; margin-top: 2rem; background-color: #e0e0e0; color: var(--dark-gray); font-size: 0.9rem; }
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: #fefefe; margin: 10% auto; padding: 20px; border: 1px solid #888; width: 90%; max-width: 600px; border-radius: var(--border-radius); }
        .modal-buttons { margin-top: 20px; text-align: center; } .modal-buttons .btn { width: 120px; margin: 0 10px; }
        .hidden { display: none; }
        #ajuda-view .card { margin-bottom: 1.5rem; } 
        #ajuda-view h3 { color: var(--primary-dark); margin-bottom: 1rem; } 
        #ajuda-view p { margin-bottom: 0.75rem; }
        .help-icon { display: inline-block; width: 20px; height: 20px; border-radius: 50%; background-color: var(--info-color); color: white; text-align: center; font-weight: bold; line-height: 20px; cursor: pointer; margin-left: 8px; font-style: normal; user-select: none; }
        #help-modal-content h3 { color: var(--primary-dark); border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px; }
        #help-modal-content p { margin-bottom: 10px; line-height: 1.7; }
        #help-modal-content strong { color: #333; }
        #config-logo-preview { max-height: 80px; border-radius: var(--border-radius); margin-top: 10px; }
    </style>
</head>
<body>

    <header>
        <h1>
            <span id="header-logo-default">üçï</span>
            <img id="header-logo" src="" alt="Logo da Empresa" class="hidden">
            <span id="header-title">Pizzaria Cost Control Pro</span>
        </h1>
        <nav id="app-nav" class="hidden">
            <a href="#" class="nav-link" data-view="dashboard">Dashboard</a>
            <a href="#" class="nav-link" data-view="fornecedores">Fornecedores</a>
            <a href="#" class="nav-link" data-view="insumos">Insumos</a>
            <a href="#" class="nav-link" data-view="receitas">Receitas</a>
            <a href="#" class="nav-link" data-view="custos-mensais">Custos Mensais</a>
            <a href="#" class="nav-link" data-view="indicadores">Indicadores</a>
            <a href="#" class="nav-link" data-view="simulador">Simulador</a>
            <a href="#" class="nav-link" data-view="ajuda">Gloss√°rio</a>
            <a href="#" class="nav-link" data-view="configuracoes">‚öôÔ∏è</a>
            <button id="logout-button">Sair</button>
        </nav>
    </header>

    <main>
        <div id="auth-container">
            <div id="login-view" class="auth-form">
                <h2>Login</h2>
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Senha</label>
                        <input type="password" id="login-password" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Entrar</button>
                </form>
                <div class="auth-link">
                    <p>N√£o tem conta? <a href="#" id="show-register">Cadastre-se</a></p>
                    <p><a href="#" id="show-reset-password">Esqueci minha senha</a></p>
                </div>
            </div>
            <div id="register-view" class="auth-form hidden">
                <h2>Cadastro</h2>
                <form id="register-form">
                    <div class="form-group">
                        <label for="register-company-name">Nome da empresa</label>
                        <input type="text" id="register-company-name" required>
                    </div>
                    <div class="form-group">
                        <label for="register-email">Email de acesso</label>
                        <input type="email" id="register-email" required>
                    </div>
                    <div class="form-group">
                        <label for="register-password">Senha (m√≠nimo 6 caracteres)</label>
                        <input type="password" id="register-password" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label for="register-logo">Logo da empresa (opcional)</label>
                        <input type="file" id="register-logo" accept="image/*">
                    </div>
                    <button type="submit" class="btn btn-primary">Cadastrar</button>
                </form>
                <div class="auth-link">
                    <p>J√° tem conta? <a href="#" id="show-login">Fa√ßa login</a></p>
                </div>
            </div>
            <div id="reset-password-view" class="auth-form hidden">
                <h2>Recuperar Senha</h2>
                <form id="reset-password-form">
                    <div class="form-group">
                        <label for="reset-email">Email</label>
                        <input type="email" id="reset-email" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Enviar link de recupera√ß√£o</button>
                </form>
                <div class="auth-link">
                    <p><a href="#" id="back-to-login">Voltar para o Login</a></p>
                </div>
            </div>
        </div>

        <div id="app-container" class="hidden">
            <!-- O restante das se√ß√µes (dashboard, fornecedores, etc.) permanece o mesmo -->
             <section id="dashboard-view" class="view">
                <h2>Dashboard</h2>
                <div class="grid-container grid-4"><div class="card kpi-card"><h3>CMV M√©dio</h3><div class="value" id="dashboard-cmv-medio">--%</div></div><div class="card kpi-card"><h3>Fornecedores</h3><div class="value" id="dashboard-num-fornecedores">--</div></div><div class="card kpi-card"><h3>Insumos</h3><div class="value" id="dashboard-num-insumos">--</div></div><div class="card kpi-card"><h3>Receitas</h3><div class="value" id="dashboard-num-receitas">--</div></div></div>
                <div class="grid-container grid-2"><div class="card"><h3>Alertas de Varia√ß√£o (> <span id="alert-threshold-display">10</span>%)</h3><div id="dashboard-alerts"><p>Nenhum alerta.</p></div></div><div class="card"><h3>Top 5 Insumos por Custo</h3><table id="dashboard-top-insumos"><thead><tr><th>Insumo</th><th>Custo/g (ou un)</th></tr></thead><tbody><tr><td colspan="2">N/A</td></tr></tbody></table></div></div>
                <div class="card"><h3>A√ß√µes R√°pidas</h3><button id="run-validation-button" class="btn btn-secondary btn-small">Validar Margherita</button><button id="generate-general-report-pdf" class="btn btn-info btn-small" style="margin-left: 1rem;">Relat√≥rio Geral (PDF)</button><div id="validation-results" class="hidden" style="margin-top: 1rem; padding: 1rem; background: #eee;"></div></div>
            </section>
            
            <section id="fornecedores-view" class="view">
                <div class="card"><h2 id="fornecedor-form-title">Cadastrar Fornecedor</h2><form id="fornecedor-form"><input type="hidden" id="fornecedor-id"><div class="form-row"><div class="form-group"><label for="fornecedor-nome">Nome <i class="help-icon" data-help-key="fornecedorNome">‚ÑπÔ∏è</i></label><input type="text" id="fornecedor-nome" required></div><div class="form-group"><label for="fornecedor-contato">Contato <i class="help-icon" data-help-key="fornecedorContato">‚ÑπÔ∏è</i></label><input type="text" id="fornecedor-contato"></div></div><div class="form-row"><div class="form-group"><label for="fornecedor-telefone">Telefone</label><input type="tel" id="fornecedor-telefone"></div><div class="form-group"><label for="fornecedor-email">Email</label><input type="email" id="fornecedor-email"></div></div><div class="form-group"><label for="fornecedor-endereco">Endere√ßo</label><input type="text" id="fornecedor-endereco"></div><button type="submit" class="btn btn-primary">Salvar Fornecedor</button><button type="button" id="cancel-edit-fornecedor" class="btn btn-secondary hidden" style="margin-top: 0.5rem;">Cancelar</button></form></div>
                <div class="card"><h2>Lista de Fornecedores</h2><table id="fornecedores-table"><thead><tr><th>Nome</th><th>Contato</th><th>Telefone</th><th>Insumos</th><th class="actions-cell">A√ß√µes</th></tr></thead><tbody></tbody></table></div>
            </section>

            <section id="insumos-view" class="view">
                <div class="card"><h2 id="insumo-form-title">Cadastrar Insumo</h2><form id="insumo-form"><input type="hidden" id="insumo-id"><div class="form-row"><div class="form-group"><label for="insumo-nome">Nome <i class="help-icon" data-help-key="insumoNome">‚ÑπÔ∏è</i></label><input type="text" id="insumo-nome" required></div><div class="form-group"><label for="insumo-fornecedor-select">Fornecedor</label><select id="insumo-fornecedor-select" required><option value="">-- Selecione --</option></select></div></div><div class="form-row"><div class="form-group"><label for="insumo-custo-embalagem">Custo Embalagem (R$) <i class="help-icon" data-help-key="insumoCustoEmbalagem">‚ÑπÔ∏è</i></label><input type="number" id="insumo-custo-embalagem" step="0.01" required></div><div class="form-group"><label for="insumo-qtd-embalagem">Qtd. Embalagem <i class="help-icon" data-help-key="insumoQtdEmbalagem">‚ÑπÔ∏è</i></label><input type="number" id="insumo-qtd-embalagem" step="0.01" required></div><div class="form-group"><label for="insumo-unidade-embalagem">Unidade</label><select id="insumo-unidade-embalagem" required><option value="kg">kg</option><option value="g">g</option><option value="L">L</option><option value="ml">ml</option><option value="un">un</option></select></div></div><div class="form-row"><div class="form-group"><label for="insumo-lote">Lote <i class="help-icon" data-help-key="insumoLote">‚ÑπÔ∏è</i></label><input type="text" id="insumo-lote"></div><div class="form-group"><label for="insumo-validade">Validade</label><input type="date" id="insumo-validade"></div></div><button type="submit" class="btn btn-primary">Salvar Insumo</button><button type="button" id="cancel-edit-insumo" class="btn btn-secondary hidden" style="margin-top: 0.5rem;">Cancelar</button></form></div>
                <div class="card"><h2>Lista de Insumos</h2><div class="filter-container"><input type="text" id="insumos-filter" placeholder="üîé Filtrar..."></div><button id="export-insumos-xlsx" class="btn btn-success btn-small">Exportar XLSX</button><table id="insumos-table"><thead><tr><th>Nome</th><th>Custo/g (un)</th><th>Fornecedor</th><th>Validade</th><th class="actions-cell">A√ß√µes</th></tr></thead><tbody></tbody></table></div>
            </section>

            <section id="receitas-view" class="view">
                <div class="card"><h2 id="receita-form-title">Criar Receita</h2><form id="receita-form"><input type="hidden" id="receita-id"><div class="form-row"><div class="form-group"><label for="receita-nome">Nome da Pizza</label><input type="text" id="receita-nome" required></div><div class="form-group"><label for="receita-versao">Vers√£o <i class="help-icon" data-help-key="receitaVersao">‚ÑπÔ∏è</i></label><input type="text" id="receita-versao" placeholder="1.0"></div></div><h3>Ingredientes</h3><div id="ingredients-list"></div><button type="button" id="add-ingredient-btn" class="btn btn-secondary btn-small">Adicionar Ingrediente</button><div id="custo-total-ingredientes" class="total-cost">Custo: R$ 0,00</div><h3>Custos Adicionais</h3><div class="form-row"><div class="form-group"><label for="receita-tempo-preparo">Preparo (min) <i class="help-icon" data-help-key="receitaTempoPreparo">‚ÑπÔ∏è</i></label><input type="number" id="receita-tempo-preparo" value="0" required></div><div class="form-group"><label for="receita-custo-embalagem">Embalagem (R$) <i class="help-icon" data-help-key="receitaEmbalagem">‚ÑπÔ∏è</i></label><input type="number" id="receita-custo-embalagem" step="0.01" value="0"></div><div class="form-group"><label for="receita-perda-percentual">Perda (%) <i class="help-icon" data-help-key="receitaPerda">‚ÑπÔ∏è</i></label><input type="number" id="receita-perda-percentual" value="0"></div></div><div class="form-group"><label for="receita-observacoes">Observa√ß√µes</label><textarea id="receita-observacoes" rows="3"></textarea></div><button type="submit" class="btn btn-primary">Salvar Receita</button><button type="button" id="cancel-edit-receita" class="btn btn-secondary hidden" style="margin-top: 0.5rem;">Cancelar</button></form></div>
                <div class="card"><h2>Lista de Receitas</h2><div class="filter-container"><input type="text" id="receitas-filter" placeholder="üîé Filtrar..."><button id="export-receitas-xlsx" class="btn btn-success btn-small">Exportar Fichas (XLSX)</button><button id="list-ingredients-pdf" class="btn btn-info btn-small">üñ®Ô∏è Listar Ingredientes (PDF)</button></div><table id="receitas-table"><thead><tr><th>Nome</th><th>Custo (COGS)</th><th>Vers√£o</th><th class="actions-cell">A√ß√µes</th></tr></thead><tbody></tbody></table></div>
            </section>

            <section id="custos-mensais-view" class="view">
                <div class="card">
                    <h2 id="custo-mensal-form-title">Lan√ßar Custos do M√™s</h2>
                    <form id="custo-mensal-form">
                        <input type="hidden" id="custo-mensal-id">
                        <div class="form-row">
                            <div class="form-group"><label for="custo-mensal-mes">M√™s/Ano</label><input type="month" id="custo-mensal-mes" required></div>
                            <div class="form-group"><label for="custo-mensal-faturamento">Faturamento (R$) <i class="help-icon" data-help-key="faturamento">‚ÑπÔ∏è</i></label><input type="number" id="custo-mensal-faturamento" step="0.01" required></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label for="custo-mensal-custosVariaveis">Custos Vari√°veis (R$) <i class="help-icon" data-help-key="custosVariaveis">‚ÑπÔ∏è</i></label><input type="number" id="custo-mensal-custosVariaveis" step="0.01"></div>
                            <div class="form-group"><label for="custo-mensal-custosFixos">Custos Fixos (R$) <i class="help-icon" data-help-key="custosFixos">‚ÑπÔ∏è</i></label><input type="number" id="custo-mensal-custosFixos" step="0.01"></div>
                        </div>
                        <div class="form-row">
                             <div class="form-group"><label for="custo-mensal-despesasOperacionais">Desp. Operacionais (R$) <i class="help-icon" data-help-key="despesasOperacionais">‚ÑπÔ∏è</i></label><input type="number" id="custo-mensal-despesasOperacionais" step="0.01"></div>
                             <div class="form-group"><label for="custo-mensal-impostos">Impostos (R$) <i class="help-icon" data-help-key="impostos">‚ÑπÔ∏è</i></label><input type="number" id="custo-mensal-impostos" step="0.01"></div>
                        </div>
                        <div class="form-row">
                           <div class="form-group"><label for="custo-mensal-outrasReceitasDespesas">Outras Receitas/Desp. (R$) <i class="help-icon" data-help-key="outrasReceitasDespesas">‚ÑπÔ∏è</i></label><input type="number" id="custo-mensal-outrasReceitasDespesas" step="0.01" placeholder="Use valor negativo para despesa"></div>
                           <div class="form-group"><label for="custo-mensal-numeroVendas">N√∫mero de Vendas <i class="help-icon" data-help-key="numeroVendas">‚ÑπÔ∏è</i></label><input type="number" id="custo-mensal-numeroVendas" step="1"></div>
                        </div>
                        <button type="submit" class="btn btn-primary">Salvar M√™s</button>
                        <button type="button" id="cancel-edit-custo-mensal" class="btn btn-secondary hidden" style="margin-top:0.5rem">Cancelar Edi√ß√£o</button>
                    </form>
                </div>
                <div class="card">
                    <h2>Hist√≥rico Mensal</h2>
                    <table id="custos-mensais-table">
                        <thead><tr><th>M√™s</th><th>Faturamento</th><th>Lucro L√≠quido</th><th class="actions-cell">A√ß√µes</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>

            <section id="indicadores-view" class="view">
                <div class="card">
                    <h2>Indicadores Financeiros Mensais</h2>
                    <div class="form-group">
                        <label for="indicadores-mes-select">Selecione o M√™s para An√°lise</label>
                        <select id="indicadores-mes-select"><option value="">-- Escolha um m√™s --</option></select>
                    </div>
                    <div id="indicadores-results" class="hidden">
                        <div class="grid-container grid-3">
                            <div class="card kpi-card"><h3>Lucro L√≠quido <i class="help-icon" data-help-key="lucroLiquido">‚ÑπÔ∏è</i></h3><div class="value" id="indicador-lucro-liquido">R$ 0,00</div></div>
                            <div class="card kpi-card"><h3>Margem L√≠quida <i class="help-icon" data-help-key="margemLiquida">‚ÑπÔ∏è</i></h3><div class="value" id="indicador-margem-liquida">0,00%</div></div>
                            <div class="card kpi-card"><h3>Markup <i class="help-icon" data-help-key="markup">‚ÑπÔ∏è</i></h3><div class="value" id="indicador-markup">0,00%</div></div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="simulador-view" class="view">
                 <div class="card"><h2>Simulador de Custo e Pre√ßo</h2><div class="form-group"><label for="simulador-receita-select">Selecione uma Receita</label><select id="simulador-receita-select"><option value="">-- Escolha --</option></select></div><div id="simulador-detalhes" class="hidden"><h3>Detalhes de Custo (COGS)</h3><table id="simulador-custos-table"><thead><tr><th>Item</th><th>Valor</th></tr></thead><tbody></tbody></table><p class="total-cost" id="simulador-cogs-total">COGS Total: R$ 0,00</p><div class="grid-container grid-2" style="margin-top: 2rem;"><div class="card"><h4>Calcular CMV por Pre√ßo</h4><div class="form-group"><label for="simulador-preco-venda">Pre√ßo de Venda (R$) <i class="help-icon" data-help-key="precoVenda">‚ÑπÔ∏è</i></label><input type="number" id="simulador-preco-venda" step="0.01"></div><div id="simulador-resultado-cmv" class="simulator-result hidden"></div><div id="cmv-visualizer-container" class="hidden"><div class="cmv-visualizer"><div id="cmv-bar" class="cmv-visualizer-bar"></div></div></div></div><div class="card"><h4>Calcular Pre√ßo Sugerido</h4><div class="form-group"><label for="simulador-meta-cmv">Meta de CMV (%) <i class="help-icon" data-help-key="metaCMV">‚ÑπÔ∏è</i></label><input type="number" id="simulador-meta-cmv" step="0.1"></div><div class="form-group"><label for="simulador-margem-desejada">Margem (%) <i class="help-icon" data-help-key="margemDesejada">‚ÑπÔ∏è</i></label><input type="number" id="simulador-margem-desejada" step="0.1"></div><div id="simulador-resultado-preco" class="simulator-result hidden"></div></div></div></div></div>
            </section>
            
            <section id="configuracoes-view" class="view">
                <div class="card">
                    <h2>Configura√ß√µes Gerais</h2>
                    <form id="configuracoes-form">
                        <div class="form-group">
                            <label for="config-company-name">Nome da Empresa</label>
                            <input type="text" id="config-company-name">
                        </div>
                        <div class="form-group">
                            <label for="config-logo-upload">Alterar Logo</label>
                            <input type="file" id="config-logo-upload" accept="image/*">
                            <img id="config-logo-preview" src="" alt="Pr√©-visualiza√ß√£o do logo" class="hidden">
                        </div>
                        <hr style="margin: 2rem 0;">
                        <div class="form-group"><label for="config-custo-hora-mao-de-obra">Custo M√£o de Obra (R$/hora) <i class="help-icon" data-help-key="configMaoDeObra">‚ÑπÔ∏è</i></label><input type="number" id="config-custo-hora-mao-de-obra" step="0.01"></div>
                        <div class="form-group"><label for="config-rateio-despesas-fixas">Rateio Fixo (R$/pizza) <i class="help-icon" data-help-key="configRateio">‚ÑπÔ∏è</i></label><input type="number" id="config-rateio-despesas-fixas" step="0.01"></div>
                        <div class="form-group"><label for="config-meta-cmv-padrao">Meta CMV Padr√£o (%) <i class="help-icon" data-help-key="configMetaCMV">‚ÑπÔ∏è</i></label><input type="number" id="config-meta-cmv-padrao" step="0.1"></div>
                        <div class="form-group"><label for="config-alerta-variacao">Alerta Varia√ß√£o Pre√ßo (%) <i class="help-icon" data-help-key="configAlerta">‚ÑπÔ∏è</i></label><input type="number" id="config-alerta-variacao" step="1"></div>
                        <button type="submit" class="btn btn-primary">Salvar Configura√ß√µes</button>
                    </form>
                </div>
            </section>

            <section id="ajuda-view" class="view">
                <h2>Gloss√°rio de Ajuda</h2>
                <div class="card"><h3>Faturamento (Receita Bruta)</h3><p><strong>F√≥rmula:</strong> Pre√ßo de Venda √ó N√∫mero de Unidades Vendidas.</p><p><strong>Significado:</strong> √â o valor total arrecadado com as vendas de produtos ou servi√ßos antes de deduzir qualquer custo ou despesa. Representa toda a entrada de dinheiro gerada pela atividade principal do neg√≥cio.</p><p><strong>Exemplo:</strong> Se uma pizzaria vende 100 pizzas a R$ 50,00 cada em um dia, o faturamento desse dia √© de R$ 5.000,00.</p><p><strong>Dica:</strong> Faturamento alto n√£o significa lucro. √â importante analisar os custos e despesas para garantir que a opera√ß√£o seja rent√°vel.</p></div>
                <div class="card"><h3>Custos Fixos (CF)</h3><p><strong>F√≥rmula:</strong> Soma de todos os custos que n√£o variam conforme o volume de produ√ß√£o ou vendas.</p><p><strong>Significado:</strong> S√£o despesas que a empresa precisa pagar todos os meses, independente do faturamento ‚Äî como aluguel, energia m√≠nima, contabilidade ou sal√°rios fixos.</p><p><strong>Exemplo:</strong> Aluguel do ponto comercial de R$ 2.000 + folha de pagamento de R$ 8.000 = R$ 10.000 de custos fixos mensais.</p><p><strong>Dica:</strong> Fa√ßa uma revis√£o peri√≥dica dos custos fixos para identificar itens que podem ser reduzidos ou renegociados sem prejudicar a opera√ß√£o.</p></div>
                <div class="card"><h3>Custos Vari√°veis (CV)</h3><p><strong>F√≥rmula:</strong> Soma dos custos que mudam proporcionalmente ao volume de produ√ß√£o ou vendas.</p><p><strong>Significado:</strong> S√£o os gastos diretamente ligados √† produ√ß√£o e venda de cada produto. Se voc√™ n√£o vende nada, esse custo √© zero. Inclui ingredientes, embalagens para delivery, etc.</p><p><strong>Exemplo:</strong> Se cada pizza consome R$ 8,00 em ingredientes e R$ 1,50 em embalagem, o custo vari√°vel por pizza √© de R$ 9,50.</p><p><strong>Dica:</strong> Negociar pre√ßos melhores com fornecedores para compras em maior volume √© a principal forma de reduzir seus custos vari√°veis e aumentar a margem de lucro por produto.</p></div>
                <div class="card"><h3>Custo da Mercadoria Vendida (CMV ou COGS)</h3><p><strong>F√≥rmula:</strong> Soma de todos os custos diretos para produzir uma unidade (ingredientes, m√£o de obra direta, embalagem, rateio de custos fixos por produto).</p><p><strong>Significado:</strong> Representa o custo total para produzir cada pizza que voc√™ vende. √â o principal indicador de custo do seu produto finalizado.</p><p><strong>Exemplo:</strong> R$ 8,00 (ingredientes) + R$ 2,00 (m√£o de obra por pizza) + R$ 1,50 (embalagem) = R$ 11,50 de CMV por pizza.</p><p><strong>Dica:</strong> Manter as fichas t√©cnicas das suas receitas sempre atualizadas √© fundamental para ter um c√°lculo de CMV preciso e garantir que seus pre√ßos de venda est√£o corretos.</p></div>
                <div class="card"><h3>Lucro L√≠quido (LL)</h3><p><strong>F√≥rmula:</strong> Faturamento - (Custos Fixos + Custos Vari√°veis + Impostos + Despesas Operacionais).</p><p><strong>Significado:</strong> √â o resultado final da empresa, ou seja, o dinheiro que efetivamente sobra no caixa ap√≥s o pagamento de todas as contas, custos e impostos. √â o indicador mais importante da sa√∫de financeira do neg√≥cio.</p><p><strong>Exemplo:</strong> Faturamento de R$ 50.000 - Total de Custos e Despesas de R$ 42.000 = R$ 8.000 de Lucro L√≠quido.</p><p><strong>Dica:</strong> Um neg√≥cio s√≥ √© sustent√°vel a longo prazo se gerar Lucro L√≠quido de forma consistente. Acompanhe este indicador mensalmente.</p></div>
                <div class="card"><h3>Margem L√≠quida (ML)</h3><p><strong>F√≥rmula:</strong> (Lucro L√≠quido / Faturamento) √ó 100.</p><p><strong>Significado:</strong> Indica a porcentagem de lucro que a empresa obt√©m para cada real de faturamento. Mostra o qu√£o eficiente √© a sua opera√ß√£o em transformar vendas em lucro real.</p><p><strong>Exemplo:</strong> (R$ 8.000 de Lucro L√≠quido / R$ 50.000 de Faturamento) √ó 100 = 16%. Isso significa que 16% de tudo que voc√™ vende se torna lucro.</p><p><strong>Dica:</strong> Uma margem l√≠quida maior indica uma empresa mais saud√°vel e rent√°vel. Compare sua margem com a de outros neg√≥cios no mesmo setor para avaliar sua competitividade.</p></div>
                <div class="card"><h3>Markup</h3><p><strong>F√≥rmula:</strong> ((Pre√ßo de Venda - Custo Total Unit√°rio) / Custo Total Unit√°rio) √ó 100.</p><p><strong>Significado:</strong> √â um √≠ndice aplicado sobre o custo do produto para formar o pre√ßo de venda. Ele mostra o quanto o seu pre√ßo est√° acima do seu custo.</p><p><strong>Exemplo:</strong> Uma pizza custa R$ 10,00 para ser feita e √© vendida por R$ 45,00. O Markup √© ((45 - 10) / 10) √ó 100 = 350%.</p><p><strong>Dica:</strong> O Markup √© uma ferramenta √∫til para a precifica√ß√£o inicial, mas n√£o deve ser confundido com a margem de lucro. A Margem L√≠quida √© um indicador mais preciso da rentabilidade geral do neg√≥cio.</p></div>
            </section>
        </div>
    </main>

    <footer><p>Pizzaria Cost Control Pro &copy; 2025.</p></footer>
    <div id="toast" class="toast"></div>
    <div id="confirm-modal" class="modal"><div class="modal-content" style="text-align: center;"><p id="confirm-modal-text">Confirmar?</p><div class="modal-buttons"><button id="confirm-modal-yes" class="btn btn-danger">Sim</button><button id="confirm-modal-no" class="btn btn-secondary">N√£o</button></div></div></div>
    
    <div id="help-modal" class="modal">
        <div id="help-modal-content" class="modal-content">
            <h3 id="help-modal-title"></h3>
            <div id="help-modal-text"></div>
            <div class="modal-buttons">
                <button id="help-modal-close" class="btn btn-primary">Fechar</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <!-- SCRIPT DO FIREBASE STORAGE -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const firebaseConfig = {
            apiKey: "AIzaSyBDB5DaXGXRWQQKVgG1bh_1WcsbfZti6uo",
            authDomain: "cmv-pizza.firebaseapp.com",
            projectId: "cmv-pizza",
            storageBucket: "cmv-pizza.appspot.com",
            messagingSenderId: "1022435006716",
            appId: "1:1022435006716:web:ec39f22702097beca25f79"
        };

        let firebaseApp, auth, db, storage, currentUser;
        let isLocalMode = false;
        let localData = { fornecedores: [], insumos: [], receitas: [], configuracoes: {}, custosMensais: [] };
        let fornecedoresCache = [], insumosCache = [], receitasCache = [], configCache = {}, custosMensaisCache = [];
        
        // ... (o objeto helpTexts continua o mesmo) ...

        if (firebaseConfig.apiKey && !firebaseConfig.apiKey.startsWith("YOUR_")) {
            try { 
                firebaseApp = firebase.initializeApp(firebaseConfig); 
                auth = firebase.auth(); 
                db = firebase.firestore();
                storage = firebase.storage();
                setupAuthListeners();
            } 
            catch (error) { 
                console.error("Erro ao inicializar Firebase:", error);
                alert("Erro na configura√ß√£o do Firebase. Verifique o console. O app rodar√° em modo local.");
                isLocalMode = true; 
                initApp(); 
            }
        } else {
            isLocalMode = true;
            console.warn("Firebase n√£o configurado. Rodando em modo local.");
            initApp();
        }

        const authContainer = document.getElementById('auth-container');
        const appContainer = document.getElementById('app-container');
        const appNav = document.getElementById('app-nav');
        const views = document.querySelectorAll('.view');
        const navLinks = document.querySelectorAll('.nav-link');

        // ... (fun√ß√µes showToast, formatCurrency, showView) ...

        function setupAuthListeners() {
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = { uid: user.uid, email: user.email };
                    authContainer.classList.add('hidden');
                    appContainer.classList.remove('hidden');
                    appNav.classList.remove('hidden');
                    initApp();
                } else {
                    currentUser = null;
                    authContainer.classList.remove('hidden');
                    appContainer.classList.add('hidden');
                    appNav.classList.add('hidden');
                    resetAppState();
                }
            });

            // Formul√°rio de Login
            document.getElementById('login-form').addEventListener('submit', async e => { /* ... (c√≥digo existente) ... */ });

            // Formul√°rio de Cadastro
            document.getElementById('register-form').addEventListener('submit', async e => {
                e.preventDefault();
                const button = e.currentTarget.querySelector('button[type="submit"]');
                button.disabled = true;
                button.textContent = 'Aguarde...';
                
                const companyName = document.getElementById('register-company-name').value;
                const email = document.getElementById('register-email').value;
                const password = document.getElementById('register-password').value;
                const logoFile = document.getElementById('register-logo').files[0];

                try {
                    const { user } = await auth.createUserWithEmailAndPassword(email, password);
                    
                    let logoUrl = '';
                    if (logoFile && storage) {
                        showToast('Enviando logo...', 'info');
                        const filePath = `logos/${user.uid}/${logoFile.name}`;
                        const fileRef = storage.ref().child(filePath);
                        await fileRef.put(logoFile);
                        logoUrl = await fileRef.getDownloadURL();
                    }

                    const configData = {
                        companyName,
                        logoUrl,
                        custo_hora_mao_de_obra: 20, 
                        rateio_por_pizza: 0.80, 
                        meta_cmv_padrao: 30, 
                        alerta_variacao: 10
                    };
                    await db.collection('configuracoes').doc(user.uid).set(configData);

                    showToast("Cadastro realizado com sucesso! Fa√ßa o login.");
                    toggleAuthViews('login-view');
                } catch (err) {
                    showToast(err.message, 'error');
                } finally {
                    button.disabled = false;
                    button.textContent = 'Cadastrar';
                }
            });
            
            // ... (restante do setupAuthListeners)
        }
        
        // ... (outras fun√ß√µes principais)

        async function fetchConfiguracoes() { 
            // ...
            // Adicionar a chamada para updateHeader() ap√≥s buscar as configura√ß√µes
            updateHeader();
            displayConfiguracoes(); 
        }

        function displayConfiguracoes() {
            // Preenche todos os campos, incluindo os novos
            document.getElementById('config-company-name').value = configCache.companyName || '';
            const logoPreview = document.getElementById('config-logo-preview');
            if (configCache.logoUrl) {
                logoPreview.src = configCache.logoUrl;
                logoPreview.classList.remove('hidden');
            } else {
                logoPreview.classList.add('hidden');
            }
            // ... (restante dos campos)
        }

        async function saveConfiguracoes(configData) { 
            configData.userId = currentUser.uid;
            
            const logoFile = document.getElementById('config-logo-upload').files[0];

            const button = document.querySelector('#configuracoes-form button[type="submit"]');
            button.disabled = true;
            button.textContent = "Salvando...";

            try {
                if (logoFile && storage) {
                    showToast('Enviando novo logo...', 'info');
                    // Apaga o logo antigo se existir
                    if (configCache.logoUrl) {
                        try {
                           const oldLogoRef = storage.refFromURL(configCache.logoUrl);
                           await oldLogoRef.delete();
                        } catch (error) {
                           console.warn("N√£o foi poss√≠vel apagar o logo antigo:", error.code);
                        }
                    }
                    const filePath = `logos/${currentUser.uid}/${logoFile.name}`;
                    const fileRef = storage.ref().child(filePath);
                    await fileRef.put(logoFile);
                    configData.logoUrl = await fileRef.getDownloadURL();
                }

                if (isLocalMode) { 
                    localData.configuracoes.default = { ...localData.configuracoes.default, ...configData }; 
                } else { 
                    await db.collection('configuracoes').doc(currentUser.uid).set(configData, { merge: true }); 
                } 
                showToast("Configura√ß√µes salvas!"); 
                configCache = { ...configCache, ...configData}; 
                
                updateHeader(); // Atualiza o cabe√ßalho imediatamente
                displayConfiguracoes(); 
                updateDashboard(); 
            } catch(error) { 
                showToast("Erro ao salvar: " + error.message, 'error'); 
            } finally {
                button.disabled = false;
                button.textContent = "Salvar Configura√ß√µes";
            }
        }
        
        // ... (O resto do seu c√≥digo JavaScript permanece o mesmo)

    });
    </script>
</body>
</html>